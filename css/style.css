/* ============================================
   Fairy Classroom v2 â€” Homevita-inspired Design
   ============================================ */

/* --- Reset & Base --- */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --pink: #FFB6C1;
  --pink-dark: #FF69B4;
  --purple: #CE93D8;
  --purple-dark: #AB47BC;
  --sky: #90CAF9;
  --mint: #A5D6A7;
  --gold: #FFD54F;
  --orange: #FF8A65;
  --white: #FFFDF7;
  --bg: #FFF5F9;
  --text: #4A3347;
  --text-light: #8B6B85;
  --shadow: rgba(180, 100, 160, 0.12);
  --radius: 20px;
  --radius-sm: 12px;
  --primary: var(--pink-dark);
  --primary-light: var(--pink);
  --font: 'Segoe UI', system-ui, -apple-system, sans-serif;
  --header-height: 56px;
  --tab-height: 64px;
}

html {
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  overflow-x: hidden;
  user-select: none;
  -webkit-user-select: none;
}

/* --- Themes --- */
.theme-pink {
  --primary: #FF69B4;
  --primary-light: #FFB6C1;
  --bg: #FFF5F9;
}
.theme-purple {
  --primary: #AB47BC;
  --primary-light: #CE93D8;
  --bg: #F9F0FF;
}

/* --- Screen Management --- */
.screen {
  display: none;
  position: fixed;
  top: var(--header-height);
  left: 0; right: 0;
  bottom: var(--tab-height);
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
}

.screen.active {
  display: flex;
  flex-direction: column;
  animation: fadeIn 0.25s ease;
}

#screen-splash, #screen-profile {
  top: 0;
  bottom: 0;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ==========================================
   FIXED HEADER
   ========================================== */
.app-header {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: var(--header-height);
  background: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  box-shadow: 0 2px 12px var(--shadow);
  z-index: 100;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 6px;
  background: none;
  border: none;
  padding: 6px 10px;
  border-radius: 50px;
  cursor: pointer;
  font-family: inherit;
  color: var(--text);
  transition: background 0.2s;
}
.header-left:active { background: var(--primary-light); }

.header-avatar-icon { font-size: 1.5rem; }
.header-name { font-size: 0.9rem; font-weight: 700; }

.header-center {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}
.header-date { font-size: 0.75rem; color: var(--text-light); }
.header-level { font-size: 0.8rem; font-weight: 700; color: var(--primary); }

.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}
.header-stars {
  background: linear-gradient(135deg, #FFF9E0, #FFE082);
  padding: 4px 10px;
  border-radius: 50px;
  font-size: 0.85rem;
  font-weight: 700;
}
.header-streak {
  font-size: 0.85rem;
  font-weight: 700;
  color: #FF5722;
}

/* ==========================================
   FIXED BOTTOM TAB BAR
   ========================================== */
.tab-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: var(--tab-height);
  background: white;
  display: flex;
  align-items: center;
  justify-content: space-around;
  box-shadow: 0 -2px 12px var(--shadow);
  z-index: 100;
  padding-bottom: env(safe-area-inset-bottom, 0);
}

.tab-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  background: none;
  border: none;
  padding: 6px 8px;
  cursor: pointer;
  font-family: inherit;
  color: var(--text-light);
  transition: all 0.2s;
  min-width: 48px;
}

.tab-btn.active {
  color: var(--primary);
}

.tab-btn.active .tab-icon {
  animation: tabBounce 0.4s ease;
}

.tab-icon { font-size: 1.4rem; line-height: 1; }
.tab-label { font-size: 0.65rem; font-weight: 600; }

@keyframes tabBounce {
  0%, 100% { transform: translateY(0); }
  40% { transform: translateY(-6px); }
  60% { transform: translateY(-3px); }
}

/* ==========================================
   SPLASH SCREEN
   ========================================== */
.splash-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100dvh;
  background: linear-gradient(135deg, var(--pink) 0%, var(--purple) 50%, var(--sky) 100%);
  position: relative;
}

.splash-fairy { font-size: 80px; animation: float 2s ease-in-out infinite; }
.splash-title {
  font-size: 2.2rem; color: white; text-align: center;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.15);
  margin-top: 16px; line-height: 1.3;
}

.splash-sparkles { position: absolute; inset: 0; pointer-events: none; }
.sparkle { position: absolute; font-size: 24px; animation: sparkle 1.5s ease-in-out infinite; }
.s1 { top: 15%; left: 20%; animation-delay: 0s; }
.s2 { top: 25%; right: 15%; animation-delay: 0.3s; }
.s3 { bottom: 30%; left: 15%; animation-delay: 0.6s; }
.s4 { bottom: 20%; right: 20%; animation-delay: 0.9s; }

@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
@keyframes sparkle {
  0%, 100% { opacity: 0.3; transform: scale(0.8) rotate(0deg); }
  50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
}

/* ==========================================
   PROFILE SELECTION
   ========================================== */
.profile-select-container {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; min-height: 100dvh; padding: 24px;
  background: linear-gradient(180deg, var(--bg) 0%, #F0E0FF 100%);
}

.profile-select-header { text-align: center; margin-bottom: 32px; }
.profile-select-fairy { font-size: 60px; animation: float 2s ease-in-out infinite; margin-bottom: 12px; }
.profile-title { font-size: 1.8rem; color: var(--text); }

.profile-cards { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }

.profile-card {
  display: flex; flex-direction: column; align-items: center;
  padding: 28px 24px; border: 3px solid transparent; border-radius: var(--radius);
  background: white; box-shadow: 0 8px 30px var(--shadow);
  cursor: pointer; transition: all 0.3s ease; min-width: 140px;
  font-family: inherit; color: var(--text);
}
.profile-card:active { transform: scale(0.95); }
.profile-dokyung { border-color: var(--pink); }
.profile-sobin { border-color: var(--purple); }
.profile-dokyung:hover { background: #FFF0F3; box-shadow: 0 8px 30px rgba(255,105,180,0.25); }
.profile-sobin:hover { background: #F8F0FF; box-shadow: 0 8px 30px rgba(171,71,188,0.25); }
.profile-card.selected { transform: scale(1.1); box-shadow: 0 12px 40px var(--shadow); }

.profile-avatar-ring {
  width: 90px; height: 90px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  margin-bottom: 12px;
}
.pink-ring { background: linear-gradient(135deg, #FFE0E8, #FFB6C1); }
.purple-ring { background: linear-gradient(135deg, #F0E0FF, #CE93D8); }

.profile-avatar { font-size: 50px; }
.profile-name { font-size: 1.5rem; font-weight: 700; }
.profile-desc { font-size: 0.85rem; color: var(--text-light); margin-top: 4px; }
.profile-badge-preview {
  margin-top: 8px; font-size: 0.75rem; color: var(--primary);
  background: #FFF5F9; padding: 4px 12px; border-radius: 50px;
}

/* ==========================================
   HOME SCREEN
   ========================================== */
.home-container {
  padding: 16px;
  background: var(--bg);
  min-height: 100%;
}

.home-section { margin-bottom: 20px; }
.home-section-title {
  font-size: 1.1rem; font-weight: 700; margin-bottom: 10px;
  color: var(--text);
}
.home-bottom-spacer { height: 16px; }

/* Today's Cards */
.today-cards { display: flex; flex-direction: column; gap: 8px; }

.today-card {
  display: flex; align-items: center; gap: 12px;
  background: white; border: none; border-radius: var(--radius-sm);
  padding: 12px 16px; box-shadow: 0 2px 10px var(--shadow);
  cursor: pointer; font-family: inherit; color: var(--text);
  transition: transform 0.2s; text-align: left;
  border-left: 4px solid var(--card-accent, var(--primary));
}
.today-card:active { transform: scale(0.98); }

.today-card-icon { font-size: 1.8rem; }
.today-card-info { flex: 1; }
.today-card-name { font-size: 0.95rem; font-weight: 700; }
.today-card-sub { font-size: 0.75rem; color: var(--text-light); }

.today-card-badge {
  background: var(--primary-light); color: var(--text);
  padding: 4px 10px; border-radius: 50px; font-size: 0.75rem; font-weight: 700;
}
.today-card-badge.complete {
  background: #C8E6C9; color: #2E7D32;
}

/* Mission Summary */
.mission-summary-card {
  display: flex; align-items: center; gap: 12px;
  background: linear-gradient(135deg, #FFF9E0, #FFE082);
  border: none; border-radius: var(--radius-sm); padding: 14px 16px;
  width: 100%; cursor: pointer; font-family: inherit; color: var(--text);
  transition: transform 0.2s;
}
.mission-summary-card:active { transform: scale(0.98); }
.mission-summary-icon { font-size: 1.5rem; }
.mission-summary-text { flex: 1; font-size: 0.95rem; font-weight: 600; text-align: left; }
.mission-summary-streak { font-size: 0.9rem; font-weight: 700; color: #FF5722; }

/* ==========================================
   TRAIN CAROUSEL
   ========================================== */
.train-carousel {
  position: relative;
  padding-bottom: 20px;
}

.train-track {
  position: absolute;
  bottom: 10px; left: 0; right: 0;
  height: 6px;
  background: repeating-linear-gradient(90deg, #8D6E63 0px, #8D6E63 20px, #D7CCC8 20px, #D7CCC8 25px);
  border-radius: 3px;
}

.train-cars {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding: 4px 4px 16px;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x proximity;
  scrollbar-width: none;
}
.train-cars::-webkit-scrollbar { display: none; }

.train-car {
  flex-shrink: 0;
  width: 110px;
  background: white;
  border: none;
  border-radius: 12px 12px 4px 4px;
  cursor: pointer;
  transition: transform 0.2s;
  scroll-snap-align: start;
  position: relative;
  font-family: inherit;
  color: var(--text);
  box-shadow: 0 3px 12px var(--shadow);
  padding: 0;
  overflow: visible;
}
.train-car:active:not(.locked) { transform: scale(0.95); }

.train-roof {
  height: 12px;
  background: var(--roof-color, var(--primary));
  border-radius: 12px 12px 0 0;
}

.train-body {
  padding: 10px 8px;
  text-align: center;
  min-height: 80px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.train-emoji { font-size: 1.5rem; }
.train-label { font-size: 0.7rem; font-weight: 600; line-height: 1.2; }
.train-badge {
  position: absolute; top: -6px; right: -6px;
  font-size: 1rem;
  animation: sparkle 2s ease-in-out infinite;
}
.train-lock {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.7); border-radius: 0 0 4px 4px;
  font-size: 1.2rem;
}

.train-car.locked { opacity: 0.6; }
.train-car.complete .train-roof { background: #4CAF50; }

.train-wheels {
  display: flex; justify-content: space-around; padding: 0 8px;
  position: relative; top: 4px;
}
.wheel {
  width: 12px; height: 12px; border-radius: 50%;
  background: #5D4037; border: 2px solid #8D6E63;
  display: inline-block;
}

/* ==========================================
   QUICK PLAY GRID
   ========================================== */
.quick-play-grid {
  display: flex; gap: 10px; overflow-x: auto;
  padding: 4px; scrollbar-width: none;
}
.quick-play-grid::-webkit-scrollbar { display: none; }

.quick-play-card {
  flex-shrink: 0; width: 100px;
  background: white; border: 2px solid var(--qp-color, var(--primary-light));
  border-radius: var(--radius-sm); padding: 14px 8px;
  text-align: center; cursor: pointer;
  font-family: inherit; color: var(--text);
  transition: transform 0.2s;
}
.quick-play-card:active { transform: scale(0.95); }
.qp-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
.qp-name { font-size: 0.75rem; font-weight: 600; }

/* ==========================================
   CATEGORY DETAIL (Stages)
   ========================================== */
.category-detail-container {
  padding: 16px; background: var(--bg); min-height: 100%;
}

.stages-list { display: flex; flex-direction: column; gap: 12px; margin-top: 16px; }

.stage-card {
  display: flex; align-items: center; justify-content: space-between;
  background: white; border: none; border-radius: var(--radius);
  padding: 16px; box-shadow: 0 3px 15px var(--shadow);
  cursor: pointer; font-family: inherit; color: var(--text);
  transition: transform 0.2s;
}
.stage-card:active:not(.locked) { transform: scale(0.98); }
.stage-card.locked { opacity: 0.5; cursor: default; }
.stage-card.complete { border-left: 4px solid #4CAF50; }

.stage-left { display: flex; align-items: center; gap: 12px; }

.stage-number {
  width: 40px; height: 40px; border-radius: 50%;
  background: var(--stage-color, var(--primary));
  color: white; display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; font-weight: 700; flex-shrink: 0;
}
.stage-number.done { background: #4CAF50; }

.stage-info { text-align: left; }
.stage-name { font-size: 1rem; font-weight: 700; }
.stage-subtitle { font-size: 0.8rem; color: var(--text-light); }

.stage-right { flex-shrink: 0; }
.stage-lock { font-size: 1.3rem; }

/* Progress Ring */
.stage-progress-ring { width: 44px; height: 44px; position: relative; }
.stage-ring-svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.stage-ring-bg {
  fill: none; stroke: #f0e0f0; stroke-width: 3;
}
.stage-ring-fill {
  fill: none; stroke-width: 3; stroke-linecap: round;
  transition: stroke-dasharray 0.5s;
}
.stage-ring-text {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.6rem; font-weight: 700;
}

.combine-section, .stage-game-section { margin-top: 20px; }
.stage-section-title { font-size: 1rem; font-weight: 700; margin-bottom: 8px; }
.stage-game-btn {
  background: var(--gold); border: none; border-radius: var(--radius-sm);
  padding: 12px 24px; font-size: 1rem; font-weight: 700;
  font-family: inherit; color: var(--text); cursor: pointer;
  transition: transform 0.2s;
}
.stage-game-btn:active { transform: scale(0.95); }

/* ==========================================
   LEARN SCREEN (Cards)
   ========================================== */
.learn-container {
  display: flex; flex-direction: column;
  min-height: 100%; padding: 16px; background: var(--bg);
}

.learn-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 16px;
}

.btn-back {
  background: white; border: 2px solid var(--primary-light);
  border-radius: 50%; width: 44px; height: 44px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem; cursor: pointer; transition: all 0.2s;
  font-family: inherit; color: var(--text);
}
.btn-back:active { background: var(--primary-light); }
.back-arrow { display: block; }

.learn-title { font-size: 1.2rem; color: var(--primary); font-weight: 700; }
.learn-counter {
  font-size: 0.85rem; color: var(--text-light);
  background: white; padding: 6px 12px; border-radius: 50px;
}

.learn-card-area {
  flex: 1; display: flex; align-items: center;
  justify-content: center; min-height: 280px;
}

.learn-card {
  width: 100%; max-width: 320px; background: white;
  border-radius: 24px; padding: 28px 20px;
  box-shadow: 0 12px 40px var(--shadow); text-align: center;
  border: 3px solid var(--card-color, var(--primary-light));
  position: relative; overflow: hidden;
}

.learn-card-inner { position: relative; z-index: 1; }
.card-enter { animation: cardEnter 0.3s ease; }
@keyframes cardEnter {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}

.card-emoji { font-size: 56px; margin-bottom: 10px; }
.card-char { font-weight: 800; line-height: 1.2; color: var(--text); margin-bottom: 6px; }
.card-word { font-size: 1.2rem; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.card-pronunciation { font-size: 0.9rem; color: var(--text-light); }

.learn-nav {
  display: flex; align-items: center; justify-content: center;
  gap: 20px; margin: 16px 0 8px;
}

.btn-nav {
  background: white; border: 2px solid var(--primary-light);
  border-radius: 50%; width: 48px; height: 48px;
  font-size: 1.2rem; cursor: pointer; transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
  font-family: inherit; color: var(--text);
}
.btn-nav:disabled { opacity: 0.3; }
.btn-nav:active:not(:disabled) { background: var(--primary-light); }

.btn-sound {
  background: var(--primary); border: none; border-radius: 50%;
  width: 60px; height: 60px; font-size: 1.6rem; cursor: pointer;
  box-shadow: 0 4px 15px rgba(255,105,180,0.3); transition: all 0.2s;
}
.btn-sound:active { transform: scale(0.9); }

.learn-dots {
  display: flex; justify-content: center; gap: 5px;
  padding: 6px 0 16px; flex-wrap: wrap;
}
.dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--primary-light); opacity: 0.4;
  cursor: pointer; transition: all 0.3s;
}
.dot.active { opacity: 1; transform: scale(1.3); background: var(--primary); }

/* ==========================================
   GAME SELECTION
   ========================================== */
.game-select-container {
  min-height: 100%; padding: 16px; background: var(--bg);
}
.play-hub-title {
  font-size: 1.3rem; font-weight: 700; text-align: center;
  margin: 16px 0; color: var(--primary);
}
.game-mode-cards {
  display: flex; flex-direction: column; gap: 12px; margin-top: 12px;
}
.game-mode-card {
  background: white; border: none; border-radius: var(--radius);
  padding: 18px 16px; display: flex; align-items: center;
  gap: 14px; box-shadow: 0 3px 15px var(--shadow);
  cursor: pointer; transition: all 0.2s; text-align: left;
  font-family: inherit; color: var(--text);
}
.game-mode-card:active { transform: scale(0.98); }
.game-mode-icon { font-size: 2rem; flex-shrink: 0; }
.game-mode-name { font-size: 1.05rem; font-weight: 700; }
.game-mode-desc { font-size: 0.8rem; color: var(--text-light); }

/* ==========================================
   QUIZ & SOUND FIND
   ========================================== */
.quiz-container, .sound-container {
  min-height: 100%; padding: 16px; background: var(--bg);
  display: flex; flex-direction: column;
}

.game-score {
  font-size: 0.9rem; background: var(--gold);
  padding: 4px 10px; border-radius: 50px; font-weight: 700;
}

.quiz-progress {
  height: 6px; background: #F0E0F0; border-radius: 3px;
  margin-bottom: 16px; overflow: hidden;
}
.quiz-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-light), var(--primary));
  border-radius: 3px; transition: width 0.3s ease;
}

.quiz-question {
  text-align: center; margin-bottom: 20px; flex: 1;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.quiz-emoji { font-size: 72px; margin-bottom: 10px; }
.quiz-word { font-size: 1.4rem; font-weight: 700; color: var(--text); }

.quiz-choices { display: grid; gap: 10px; margin-bottom: 20px; }
.choices-2 { grid-template-columns: repeat(2, 1fr); }
.choices-4 { grid-template-columns: repeat(2, 1fr); }

.quiz-choice {
  background: white; border: 3px solid var(--primary-light);
  border-radius: var(--radius); padding: 16px 10px;
  text-align: center; cursor: pointer; transition: all 0.2s;
  font-family: inherit; display: flex; flex-direction: column;
  align-items: center; gap: 4px;
}
.quiz-choice:active:not(:disabled) { transform: scale(0.95); }
.choice-char { font-weight: 800; color: var(--text); display: block; }
.choice-emoji { font-size: 1.1rem; }

.quiz-choice.correct { background: #C8E6C9; border-color: #4CAF50; animation: correctPulse 0.5s ease; }
.quiz-choice.wrong { background: #FFCDD2; border-color: #EF5350; animation: wrongShake 0.4s ease; }
.quiz-choice:disabled { opacity: 0.6; }

.quiz-hint { text-align: center; color: var(--primary); font-size: 0.85rem; animation: fadeIn 0.5s; }
.hint-glow { animation: hintGlow 1s ease-in-out infinite !important; border-color: var(--gold) !important; }

@keyframes correctPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
@keyframes wrongShake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
@keyframes hintGlow { 0%,100% { box-shadow: 0 0 5px var(--gold); } 50% { box-shadow: 0 0 20px var(--gold), 0 0 40px var(--gold); } }

/* Sound Find */
.sound-prompt {
  text-align: center; flex: 1;
  display: flex; align-items: center; justify-content: center;
}
.btn-play-sound {
  background: white; border: 3px solid var(--primary);
  border-radius: 50%; width: 110px; height: 110px;
  font-size: 2.5rem; cursor: pointer;
  box-shadow: 0 8px 30px var(--shadow); transition: all 0.2s;
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; font-family: inherit; color: var(--text);
}
.btn-play-sound:active { transform: scale(0.9); }
.sound-label { font-size: 0.75rem; margin-top: 4px; }

/* ==========================================
   MATCHING
   ========================================== */
.matching-container { min-height: 100%; padding: 16px; background: var(--bg); }
.matching-grid {
  display: grid; gap: 10px; margin-top: 20px; justify-items: center;
}
.cols-2 { grid-template-columns: repeat(2, 1fr); }
.cols-4 { grid-template-columns: repeat(4, 1fr); }

.matching-card {
  width: 100%; aspect-ratio: 1; max-width: 100px;
  perspective: 600px; cursor: pointer;
  background: none; border: none; padding: 0; font-family: inherit;
}
.matching-card-inner {
  width: 100%; height: 100%; position: relative;
  transform-style: preserve-3d; transition: transform 0.5s ease;
  border-radius: var(--radius);
}
.matching-card.flipped .matching-card-inner,
.matching-card.matched .matching-card-inner { transform: rotateY(180deg); }

.matching-card-front, .matching-card-back {
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius);
  backface-visibility: hidden; -webkit-backface-visibility: hidden;
}
.matching-card-front {
  background: linear-gradient(135deg, var(--primary-light), var(--primary));
  color: white; font-size: 1.5rem; font-weight: 700;
  box-shadow: 0 3px 12px var(--shadow);
}
.matching-card-back {
  background: white; border: 3px solid var(--primary-light);
  transform: rotateY(180deg); font-weight: 700; color: var(--text);
}
.matching-card.matched .matching-card-back {
  border-color: #4CAF50; background: #E8F5E9;
}

/* ==========================================
   TRACING (Canvas)
   ========================================== */
.tracing-container {
  min-height: 100%; padding: 16px; background: var(--bg);
  display: flex; flex-direction: column;
}

.tracing-area {
  flex: 1; display: flex; align-items: center; justify-content: center;
  position: relative; margin: 16px 0;
}

.tracing-char-bg {
  position: absolute; font-size: 180px; font-weight: 800;
  color: rgba(0,0,0,0.06); user-select: none;
  pointer-events: none; z-index: 0;
}

#tracing-canvas {
  border: 3px dashed var(--primary-light);
  border-radius: var(--radius);
  background: rgba(255,255,255,0.8);
  touch-action: none;
  position: relative; z-index: 1;
  max-width: 300px; max-height: 300px;
}

.tracing-buttons {
  display: flex; gap: 10px; justify-content: center; padding: 12px 0;
}

.tracing-success { animation: correctPulse 0.5s ease; }
.tracing-shake { animation: wrongShake 0.4s ease; }

/* ==========================================
   COUNTING GAME
   ========================================== */
.counting-container {
  min-height: 100%; padding: 16px; background: var(--bg);
  display: flex; flex-direction: column;
}

.counting-question {
  text-align: center; font-size: 1.3rem; font-weight: 700;
  margin: 16px 0; color: var(--primary);
}

.counting-emoji-area {
  flex: 1; position: relative;
  background: white; border-radius: var(--radius);
  box-shadow: 0 4px 20px var(--shadow);
  min-height: 200px; margin-bottom: 16px;
}

.counting-emoji {
  position: absolute; font-size: 2.5rem; cursor: pointer;
  transition: transform 0.3s; user-select: none;
}
.counting-emoji.counted {
  transform: scale(1.3);
  filter: drop-shadow(0 0 8px var(--gold));
}

.counting-counter {
  position: absolute; top: 8px; right: 12px;
  background: var(--gold); padding: 4px 14px;
  border-radius: 50px; font-size: 1.2rem; font-weight: 700;
}

.counting-choices {
  display: flex; gap: 10px; justify-content: center;
  padding: 8px 0;
}

.counting-choice {
  width: 56px; height: 56px; border-radius: 50%;
  background: white; border: 3px solid var(--primary-light);
  font-size: 1.5rem; font-weight: 800;
  cursor: pointer; transition: all 0.2s;
  font-family: inherit; color: var(--text);
}
.counting-choice:active { transform: scale(0.9); }
.counting-choice.correct { background: #C8E6C9; border-color: #4CAF50; }
.counting-choice.wrong { background: #FFCDD2; border-color: #EF5350; }

/* ==========================================
   HANGUL COMBINATION
   ========================================== */
.combine-container {
  min-height: 100%; padding: 16px; background: var(--bg);
}

.combine-result-area {
  background: white; border-radius: var(--radius);
  padding: 24px; margin: 16px 0; text-align: center;
  box-shadow: 0 4px 20px var(--shadow);
}

.combine-formula {
  display: flex; align-items: center; justify-content: center; gap: 12px;
}

.combine-slot {
  width: 60px; height: 60px;
  display: flex; align-items: center; justify-content: center;
  font-size: 2rem; font-weight: 800;
  border: 3px dashed var(--primary-light);
  border-radius: var(--radius-sm);
  background: #FFF5F9;
}

.combine-plus, .combine-equals {
  font-size: 1.5rem; font-weight: 700; color: var(--text-light);
}

.result-slot { border-color: var(--gold); background: #FFF9E0; }
.combine-success {
  animation: correctPulse 0.5s ease;
  background: #C8E6C9 !important;
  border-color: #4CAF50 !important;
}

.combine-section-label {
  font-size: 0.9rem; font-weight: 700; color: var(--text-light);
  margin: 16px 0 8px;
}

.combine-grid {
  display: grid; grid-template-columns: repeat(5, 1fr);
  gap: 8px;
}

.combine-btn {
  background: white; border: 2px solid var(--primary-light);
  border-radius: var(--radius-sm); padding: 12px 4px;
  font-size: 1.3rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s;
  font-family: inherit; color: var(--text);
}
.combine-btn:active { transform: scale(0.95); }
.combine-btn.selected {
  background: var(--primary); color: white;
  border-color: var(--primary);
}

/* ==========================================
   COLORING
   ========================================== */
.coloring-select-container {
  min-height: 100%; padding: 16px; background: var(--bg);
}

.coloring-designs-grid {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 12px; margin-top: 16px;
}

.coloring-design-card {
  background: white; border: 2px solid var(--primary-light);
  border-radius: var(--radius); padding: 16px;
  text-align: center; cursor: pointer; transition: all 0.2s;
  font-family: inherit; color: var(--text); position: relative;
}
.coloring-design-card:active { transform: scale(0.95); }
.design-emoji { font-size: 2.5rem; margin-bottom: 6px; }
.design-name { font-size: 0.85rem; font-weight: 600; }
.design-done-badge {
  position: absolute; top: -4px; right: -4px;
  background: #4CAF50; color: white;
  width: 20px; height: 20px; border-radius: 50%;
  font-size: 0.7rem; display: flex; align-items: center; justify-content: center;
}

.coloring-container {
  min-height: 100%; padding: 16px; background: var(--bg);
  display: flex; flex-direction: column;
}

.coloring-canvas-area {
  flex: 1; display: flex; align-items: center;
  justify-content: center; padding: 8px;
}

.coloring-svg {
  width: 100%; max-width: 300px; height: auto;
  background: white; border-radius: var(--radius);
  box-shadow: 0 4px 20px var(--shadow);
  padding: 16px;
}

.coloring-region { cursor: pointer; transition: transform 0.2s; }
.coloring-region:hover { filter: brightness(1.1); }

.coloring-palette {
  display: flex; justify-content: center; gap: 8px;
  padding: 12px 0; flex-wrap: wrap;
}

.palette-color {
  width: 40px; height: 40px; border-radius: 50%;
  border: 3px solid transparent; cursor: pointer;
  transition: all 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.palette-color.selected {
  border-color: var(--text);
  transform: scale(1.2);
  box-shadow: 0 0 12px rgba(0,0,0,0.2);
}

.coloring-actions {
  display: flex; gap: 10px; justify-content: center; padding: 8px 0;
}

/* Gallery */
.gallery-section { margin-top: 24px; }
.gallery-grid {
  display: grid; grid-template-columns: repeat(3, 1fr);
  gap: 10px; margin-top: 8px;
}
.gallery-item {
  background: white; border-radius: var(--radius-sm);
  padding: 12px; text-align: center;
  box-shadow: 0 2px 8px var(--shadow);
}
.gallery-mini-svg { font-size: 2rem; }
.gallery-date { font-size: 0.7rem; color: var(--text-light); margin-top: 4px; }

/* ==========================================
   REWARD SCREEN
   ========================================== */
.reward-container {
  min-height: 100%; padding: 16px; padding-bottom: 24px;
  background: var(--bg);
}

.reward-section {
  background: white; border-radius: var(--radius);
  padding: 16px; margin-bottom: 12px;
  box-shadow: 0 3px 15px var(--shadow);
}

.reward-section-title {
  font-size: 1rem; margin-bottom: 10px; color: var(--text); font-weight: 700;
}

/* Level display */
.level-section {
  background: linear-gradient(135deg, #FFF9E0, #FFE082) !important;
}
.level-display {
  display: flex; align-items: center; gap: 16px;
}
.level-icon-big { font-size: 3rem; }
.level-info { flex: 1; }
.level-name-big { font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; }
.level-xp-bar {
  height: 10px; background: rgba(0,0,0,0.1);
  border-radius: 5px; overflow: hidden; margin-bottom: 4px;
}
.level-xp-fill {
  height: 100%;
  background: linear-gradient(90deg, #FFD54F, #FF9800);
  border-radius: 5px; transition: width 0.5s;
}
.level-xp-text { font-size: 0.75rem; color: var(--text-light); }

/* Stars */
.star-counter-big {
  font-size: 1.4rem; word-break: break-all; line-height: 1.8;
}
.more-stars { font-size: 0.9rem; color: var(--text-light); margin-left: 4px; }

/* Stickers */
.sticker-grid {
  display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px;
}
.sticker-slot {
  aspect-ratio: 1; display: flex; align-items: center;
  justify-content: center; font-size: 1.3rem;
  border-radius: var(--radius-sm); transition: all 0.3s;
}
.sticker-slot.collected { background: #FFF9E0; animation: stickerShine 3s ease-in-out infinite; }
.sticker-slot.locked { background: #F5F0F5; opacity: 0.5; font-size: 0.9rem; }

@keyframes stickerShine { 0%,100% { box-shadow: none; } 50% { box-shadow: 0 0 8px var(--gold); } }

/* Badges */
.badge-grid {
  display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
}
.badge-slot {
  text-align: center; padding: 10px 6px;
  border-radius: var(--radius-sm); transition: all 0.3s;
}
.badge-slot.earned { background: linear-gradient(135deg, #FFF9E0, #FFF3C4); }
.badge-slot.locked { opacity: 0.4; }
.badge-icon { font-size: 1.8rem; margin-bottom: 4px; }
.badge-name { font-size: 0.7rem; font-weight: 700; color: var(--text); }
.badge-desc { font-size: 0.6rem; color: var(--text-light); margin-top: 2px; }

/* ==========================================
   ATTENDANCE & MISSIONS
   ========================================== */
.attendance-container {
  min-height: 100%; padding: 16px; background: var(--bg);
}

.streak-banner {
  display: flex; align-items: center; justify-content: center;
  gap: 8px; background: linear-gradient(135deg, #FFF3E0, #FFE0B2);
  padding: 12px; border-radius: var(--radius); margin-bottom: 16px;
}
.streak-fire { font-size: 1.5rem; }
.streak-count { font-size: 1.1rem; font-weight: 700; color: #E65100; }

/* Calendar */
.calendar-container { margin-top: 8px; }
.cal-header-row {
  display: grid; grid-template-columns: repeat(7, 1fr);
  text-align: center; font-size: 0.7rem; font-weight: 700;
  color: var(--text-light); margin-bottom: 4px;
}
.cal-grid {
  display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px;
}
.cal-empty { aspect-ratio: 1; }
.cal-day {
  aspect-ratio: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  font-size: 0.8rem; font-weight: 600; border-radius: 8px;
  position: relative;
}
.cal-day.today { background: var(--primary-light); color: white; }
.cal-day.attended { background: #FFF9E0; }
.cal-star {
  font-size: 0.5rem; position: absolute; bottom: 1px;
}
.attendance-summary {
  text-align: center; font-size: 0.8rem;
  color: var(--text-light); margin-top: 8px;
}

/* Missions */
.missions-list { display: flex; flex-direction: column; gap: 8px; }

.mission-card {
  display: flex; align-items: center; gap: 10px;
  padding: 10px; border-radius: var(--radius-sm);
  background: #FAFAFA;
}
.mission-card.done { background: #E8F5E9; }
.mission-icon { font-size: 1.3rem; flex-shrink: 0; }
.mission-info { flex: 1; }
.mission-text { font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; }
.mission-progress-bar {
  height: 5px; background: #E0E0E0; border-radius: 3px; overflow: hidden;
}
.mission-progress-fill {
  height: 100%; background: var(--primary); border-radius: 3px;
  transition: width 0.3s;
}
.mission-status { font-size: 0.8rem; font-weight: 700; color: var(--text-light); flex-shrink: 0; }
.mission-empty {
  text-align: center; padding: 16px; color: var(--text-light);
  font-size: 0.9rem;
}
.missions-complete-banner {
  text-align: center; padding: 12px; margin-top: 8px;
  background: linear-gradient(135deg, #FFF9E0, #FFE082);
  border-radius: var(--radius-sm); font-weight: 700;
}

/* ==========================================
   PARENT PAGE
   ========================================== */
.parent-container {
  min-height: 100%; padding: 16px; background: #F5F5F5;
}
.parent-header { margin-bottom: 16px; }
.parent-title { font-size: 1.2rem; font-weight: 700; }

.parent-profile-section {
  background: white; border-radius: var(--radius);
  padding: 16px; margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.parent-profile-header {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 16px;
}
.parent-avatar { font-size: 2rem; }
.parent-name { font-size: 1.1rem; font-weight: 700; flex: 1; }
.parent-level { font-size: 0.85rem; font-weight: 700; color: var(--primary); }

.parent-stats-grid {
  display: grid; grid-template-columns: repeat(4, 1fr);
  gap: 8px; margin-bottom: 16px;
}
.parent-stat {
  text-align: center; padding: 8px;
  background: #F9F9F9; border-radius: 8px;
}
.parent-stat-value { font-size: 1.2rem; font-weight: 800; color: var(--primary); }
.parent-stat-label { font-size: 0.6rem; color: var(--text-light); margin-top: 2px; }

.parent-category-progress { margin-bottom: 16px; }
.parent-category-progress h4 { font-size: 0.85rem; margin-bottom: 8px; }

.parent-progress-row {
  display: flex; align-items: center; gap: 8px; margin-bottom: 6px;
}
.parent-progress-label { font-size: 0.8rem; width: 60px; flex-shrink: 0; }
.parent-progress-bar {
  flex: 1; height: 8px; background: #EEEEEE;
  border-radius: 4px; overflow: hidden;
}
.parent-progress-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
.parent-progress-text { font-size: 0.75rem; font-weight: 700; width: 32px; text-align: right; }

.parent-weekly { margin-bottom: 16px; }
.parent-weekly h4 { font-size: 0.85rem; margin-bottom: 8px; }

.parent-weekly-chart {
  display: flex; align-items: flex-end; gap: 6px;
  height: 80px;
}
.parent-weekly-bar {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; height: 100%;
  justify-content: flex-end;
}
.parent-bar-fill {
  width: 100%; border-radius: 4px 4px 0 0;
  background: #E0E0E0; transition: height 0.5s;
}
.parent-bar-fill.active { background: var(--primary); }
.parent-bar-label { font-size: 0.65rem; margin-top: 4px; color: var(--text-light); }

.parent-actions {
  text-align: center; margin-top: 16px;
}
.parent-reset-btn { color: #EF5350; border-color: #EF5350; }

/* ==========================================
   RESULT SCREEN
   ========================================== */
.result-container {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  min-height: 100%; padding: 24px; text-align: center;
  background: var(--bg);
}
.result-stars { font-size: 1.8rem; margin-bottom: 16px; animation: float 2s ease-in-out infinite; }
.result-message { font-size: 1.8rem; margin-bottom: 10px; color: var(--primary); }
.result-score { font-size: 2.5rem; font-weight: 800; color: var(--text); margin-bottom: 28px; }
.result-buttons {
  display: flex; flex-direction: column; gap: 10px;
  width: 100%; max-width: 260px;
}

/* ==========================================
   BUTTONS
   ========================================== */
.btn-primary {
  background: var(--primary); color: white; border: none;
  border-radius: 50px; padding: 12px 24px;
  font-size: 1rem; font-weight: 700; font-family: inherit;
  cursor: pointer; box-shadow: 0 4px 12px rgba(255,105,180,0.3);
  transition: all 0.2s;
}
.btn-primary:active { transform: scale(0.95); }

.btn-secondary {
  background: white; color: var(--text);
  border: 2px solid var(--primary-light);
  border-radius: 50px; padding: 10px 20px;
  font-size: 0.95rem; font-weight: 600; font-family: inherit;
  cursor: pointer; transition: all 0.2s;
}
.btn-secondary:active { background: var(--primary-light); }

/* ==========================================
   POPUPS
   ========================================== */
.popup-overlay {
  position: fixed; inset: 0; background: rgba(0,0,0,0.4);
  display: flex; align-items: center; justify-content: center;
  z-index: 1000; animation: fadeIn 0.3s ease;
}

.popup-content {
  background: white; border-radius: 24px;
  padding: 28px 20px; text-align: center;
  max-width: 300px; width: 90%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.2);
  animation: popIn 0.4s ease;
}

@keyframes popIn {
  from { transform: scale(0.5); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.popup-sticker, .popup-badge { font-size: 4rem; margin-bottom: 10px; }
.popup-badge-name { font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
.popup-text { font-size: 1rem; color: var(--text); margin-bottom: 16px; }

/* Level-up popup */
.levelup-popup { background: linear-gradient(135deg, #FFF9E0, #FFE082); }
.levelup-sparkles { font-size: 2rem; margin-bottom: 8px; animation: sparkle 1s infinite; }
.levelup-icon { font-size: 4rem; margin-bottom: 8px; animation: float 1s ease-in-out infinite; }
.levelup-title { font-size: 1.5rem; font-weight: 800; color: #FF6F00; margin-bottom: 4px; }
.levelup-level { font-size: 2rem; font-weight: 800; color: var(--text); }
.levelup-name { font-size: 1rem; color: var(--text-light); margin-bottom: 16px; }

/* Stamp popup */
.stamp-popup { background: linear-gradient(135deg, #E3F2FD, #BBDEFB); }
.stamp-icon { font-size: 3.5rem; margin-bottom: 8px; }
.stamp-title { font-size: 1.3rem; font-weight: 800; color: #1565C0; margin-bottom: 4px; }
.stamp-text { font-size: 1rem; color: var(--text); margin-bottom: 8px; }
.stamp-bonus { font-size: 0.9rem; font-weight: 700; color: #E65100; margin-bottom: 8px; }
.stamp-streak { font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; }

/* ==========================================
   FLOATING STAR
   ========================================== */
.floating-star {
  position: fixed; font-size: 1.8rem; bottom: 30%;
  z-index: 999; pointer-events: none;
  animation: floatUp 1s ease-out forwards;
}
@keyframes floatUp {
  from { opacity: 1; transform: translateY(0) scale(1); }
  to { opacity: 0; transform: translateY(-150px) scale(1.5); }
}

/* ==========================================
   PROGRESS BAR (generic)
   ========================================== */
.progress-bar {
  height: 8px; background: #F0E0F0;
  border-radius: 4px; overflow: hidden; margin-bottom: 4px;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-light), var(--primary));
  border-radius: 4px; transition: width 0.5s ease;
}
.progress-text { font-size: 0.7rem; color: var(--text-light); }

/* ==========================================
   RESPONSIVE
   ========================================== */
@media (min-width: 480px) {
  .learn-card { max-width: 380px; }
  .matching-grid { max-width: 500px; margin-left: auto; margin-right: auto; }
  .coloring-designs-grid { max-width: 400px; margin-left: auto; margin-right: auto; }
}

@media (min-width: 768px) {
  .profile-card { padding: 36px 32px; }
  .profile-avatar { font-size: 60px; }
  .splash-fairy { font-size: 100px; }
  .splash-title { font-size: 3rem; }
  .train-car { width: 130px; }
}

/* Safe area for notched phones */
@supports (padding: env(safe-area-inset-top)) {
  .app-header { padding-top: env(safe-area-inset-top); height: calc(var(--header-height) + env(safe-area-inset-top)); }
  .screen { top: calc(var(--header-height) + env(safe-area-inset-top)); }
  #screen-splash, #screen-profile { top: 0; }
  .tab-bar { height: calc(var(--tab-height) + env(safe-area-inset-bottom)); }
}

/* Sparkle background for home */
.home-container::before {
  content: ''; position: fixed; top: 0; left: 0;
  width: 100%; height: 100%; pointer-events: none;
  background-image:
    radial-gradient(2px 2px at 20% 30%, var(--primary-light) 50%, transparent 50%),
    radial-gradient(2px 2px at 40% 70%, var(--gold) 50%, transparent 50%),
    radial-gradient(2px 2px at 60% 20%, var(--purple) 50%, transparent 50%),
    radial-gradient(2px 2px at 80% 60%, var(--pink) 50%, transparent 50%);
  opacity: 0.2; z-index: 0;
}
.home-container > * { position: relative; z-index: 1; }
